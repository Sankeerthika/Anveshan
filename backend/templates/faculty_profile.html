{% extends "base.html" %}

{% block title %}My Profile (Faculty) | Anveshan{% endblock %}

{% block page_content %}
<div class="container py-4">
    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h1 class="h3 fw-bold text-dark">My Profile</h1>
            <p class="text-muted mb-0">Update your personal information and professional details.</p>
        </div>
    </div>

    <div class="row justify-content-center">
        <div class="col-lg-10">
            <div class="card shadow-sm border-0 rounded-4">
                <div class="card-body p-5">
                    <form method="POST" enctype="multipart/form-data">
                        
                        <!-- Profile Photo Section -->
                        <div class="d-flex flex-column align-items-center mb-5">
                            <div class="position-relative">
                                <img id="avatar-preview" 
                                     src="{{ url_for('static', filename='uploads/profile_pics/' + (user.profile_photo if user.profile_photo else 'default.png')) }}" 
                                     alt="Profile" 
                                     class="rounded-circle shadow-sm object-fit-cover"
                                     style="width: 150px; height: 150px; border: 4px solid white;"
                                     onerror="this.src='https://ui-avatars.com/api/?name={{ user.name }}&background=random'">
                                
                                <label for="profile_photo" class="position-absolute bottom-0 end-0 bg-white rounded-circle shadow p-2" style="cursor: pointer; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center;">
                                    <i class="bi bi-camera-fill text-primary"></i>
                                </label>
                                <input type="file" id="profile_photo" name="profile_photo" class="d-none" accept="image/*" onchange="previewImage(this)">
                            </div>
                            <h4 class="mt-3 mb-1 fw-bold">{{ user.name or 'Faculty Member' }}</h4>
                            <p class="text-muted mb-0">{{ user.role|title }}</p>
                        </div>

                        <div class="row g-4">
                            <!-- Basic Info -->
                            <div class="col-12">
                                <h5 class="fw-bold text-primary mb-3"><i class="bi bi-person-lines-fill me-2"></i>Basic Information</h5>
                            </div>
                            
                            <div class="col-md-6">
                                <label for="name" class="form-label fw-medium">Full Name</label>
                                <input type="text" id="name" name="name" class="form-control form-control-lg bg-light border-0" value="{{ user.name or '' }}">
                            </div>
                            
                            <div class="col-md-6">
                                <label for="branch" class="form-label fw-medium">Department</label>
                                <input type="text" id="branch" name="branch" class="form-control form-control-lg bg-light border-0" value="{{ user.branch or '' }}" placeholder="e.g. Computer Science">
                            </div>
                            
                            <div class="col-md-6">
                                <label for="year" class="form-label fw-medium">Designation</label>
                                <input type="text" id="year" name="year" class="form-control form-control-lg bg-light border-0" value="{{ user.year or '' }}" placeholder="e.g. Assistant Professor">
                            </div>
                            
                            <div class="col-md-6">
                                <label for="section" class="form-label fw-medium">Office / Room</label>
                                <input type="text" id="section" name="section" class="form-control form-control-lg bg-light border-0" value="{{ user.section or '' }}" placeholder="e.g. Block A-203">
                            </div>
                            
                            <div class="col-12">
                                <label for="bio" class="form-label fw-medium">Bio</label>
                                <textarea id="bio" name="bio" rows="4" class="form-control bg-light border-0" placeholder="Share a brief introduction about yourself...">{{ user.bio or '' }}</textarea>
                            </div>

                            <!-- Skills & Interests -->
                            <div class="col-12 mt-4">
                                <h5 class="fw-bold text-primary mb-3"><i class="bi bi-stars me-2"></i>Expertise & Interests</h5>
                            </div>
                            
                            <div class="col-12">
                                <label for="skills" class="form-label fw-medium">Skills (Comma separated)</label>
                                <input type="text" id="skills" name="skills" class="form-control form-control-lg bg-light border-0" value="{{ user.skills or '' }}" placeholder="e.g. Machine Learning, Data Analysis, Python">
                            </div>
                            
                            <div class="col-12">
                                <label for="interests" class="form-label fw-medium">Research Interests (Comma separated)</label>
                                <input type="text" id="interests" name="interests" class="form-control form-control-lg bg-light border-0" value="{{ user.interests or '' }}" placeholder="e.g. AI Ethics, Cloud Computing, IoT">
                            </div>

                            <!-- Social Links -->
                            <div class="col-12 mt-4">
                                <h5 class="fw-bold text-primary mb-3"><i class="bi bi-link-45deg me-2"></i>Social & Professional Links</h5>
                            </div>
                            
                            <div class="col-md-6">
                                <label for="linkedin_url" class="form-label fw-medium"><i class="bi bi-linkedin text-primary me-1"></i> LinkedIn</label>
                                <input type="url" id="linkedin_url" name="linkedin_url" class="form-control bg-light border-0" value="{{ user.linkedin_url or '' }}" placeholder="https://linkedin.com/in/...">
                            </div>
                            
                            <div class="col-md-6">
                                <label for="github_url" class="form-label fw-medium"><i class="bi bi-github text-dark me-1"></i> GitHub</label>
                                <input type="url" id="github_url" name="github_url" class="form-control bg-light border-0" value="{{ user.github_url or '' }}" placeholder="https://github.com/...">
                            </div>
                            
                            <div class="col-md-6">
                                <label for="portfolio_url" class="form-label fw-medium"><i class="bi bi-globe me-1"></i> Portfolio / Website</label>
                                <input type="url" id="portfolio_url" name="portfolio_url" class="form-control bg-light border-0" value="{{ user.portfolio_url or '' }}" placeholder="https://mywebsite.com">
                            </div>
                            
                            <div class="col-md-6">
                                <label for="medium_url" class="form-label fw-medium"><i class="bi bi-medium text-dark me-1"></i> Medium / Blog</label>
                                <input type="url" id="medium_url" name="medium_url" class="form-control bg-light border-0" value="{{ user.medium_url or '' }}" placeholder="https://medium.com/@...">
                            </div>

                            <div class="col-12 mt-5 text-end">
                                <button type="submit" class="btn btn-primary btn-lg px-5 rounded-pill shadow-sm">
                                    <i class="bi bi-check-lg me-2"></i>Save Changes
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    function previewImage(input) {
        if (input.files && input.files[0]) {
            const reader = new FileReader();
            reader.onload = function(e) {
                document.getElementById('avatar-preview').src = e.target.result;
            };
            reader.readAsDataURL(input.files[0]);
        }
    }
</script>
{% endblock %}
